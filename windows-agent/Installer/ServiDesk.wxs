<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">

  <Package Name="ServiDesk"
           Manufacturer="HelpTech.cz"
           Version="!(bind.fileVersion.ServiDeskExe)"
           UpgradeCode="B7A3F2E1-4D5C-6E7F-8A9B-0C1D2E3F4A5B"
           Scope="perMachine">

    <MajorUpgrade DowngradeErrorMessage="Novější verze ServiDesk je již nainstalována." />
    <MediaTemplate EmbedCab="yes" CompressionLevel="high" />

    <!-- Icon for Add/Remove Programs -->
    <Icon Id="AppIcon" SourceFile="publish\ServiDesk\ServiDesk.exe" />
    <Property Id="ARPPRODUCTICON" Value="AppIcon" />
    <Property Id="ARPHELPLINK" Value="https://github.com/HelpTechCZ/ServiDesk" />
    <Property Id="ARPURLINFOABOUT" Value="https://helptech.cz" />

    <!-- Directories -->
    <StandardDirectory Id="ProgramFiles6432Folder">
      <Directory Id="INSTALLFOLDER" Name="ServiDesk" />
    </StandardDirectory>
    <StandardDirectory Id="ProgramMenuFolder" />
    <StandardDirectory Id="DesktopFolder" />

    <!-- Main EXE -->
    <ComponentGroup Id="AppFiles" Directory="INSTALLFOLDER">
      <Component Id="MainExecutable" Guid="*">
        <File Id="ServiDeskExe"
              Source="publish\ServiDesk\ServiDesk.exe"
              KeyPath="yes" />
      </Component>
    </ComponentGroup>

    <!-- Start Menu shortcut -->
    <Component Id="StartMenuShortcut" Directory="ProgramMenuFolder" Guid="*">
      <Shortcut Id="StartMenuLink"
                Name="ServiDesk"
                Target="[INSTALLFOLDER]ServiDesk.exe"
                WorkingDirectory="INSTALLFOLDER"
                Icon="AppIcon" />
      <RegistryValue Root="HKCU"
                     Key="Software\HelpTech\ServiDesk"
                     Name="StartMenuShortcut"
                     Type="integer" Value="1" KeyPath="yes" />
    </Component>

    <!-- Desktop shortcut -->
    <Component Id="DesktopShortcut" Directory="DesktopFolder" Guid="*">
      <Shortcut Id="DesktopLink"
                Name="ServiDesk"
                Target="[INSTALLFOLDER]ServiDesk.exe"
                WorkingDirectory="INSTALLFOLDER"
                Icon="AppIcon" />
      <RegistryValue Root="HKCU"
                     Key="Software\HelpTech\ServiDesk"
                     Name="DesktopShortcut"
                     Type="integer" Value="1" KeyPath="yes" />
    </Component>

    <!-- Feature -->
    <Feature Id="Main" Title="ServiDesk" Level="1">
      <ComponentGroupRef Id="AppFiles" />
      <ComponentRef Id="StartMenuShortcut" />
      <ComponentRef Id="DesktopShortcut" />
    </Feature>

  </Package>
</Wix>
